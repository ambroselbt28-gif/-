# 反派逆袭系统 - 角色卡分享快速开始

## 🎉 好消息！

你的游戏现在可以**通过角色卡分享**，用户**无需任何安装**就能直接玩！

---

## 🚀 开发者：5 步完成部署

### 1️⃣ 安装依赖
```bash
cd villain-game-app
npm install
```

### 2️⃣ 本地测试
```bash
npm run build
# 查看 dist/index.html
```

### 3️⃣ 配置 Cloudflare
1. 注册 https://dash.cloudflare.com/
2. 获取 API Token 和 Account ID
3. 在 GitHub 仓库添加 Secrets：
   - `CLOUDFLARE_API_TOKEN`
   - `CLOUDFLARE_ACCOUNT_ID`

### 4️⃣ 推送代码
```bash
git add .
git commit -m "配置角色卡分享"
git push origin main
```

GitHub Actions 会自动构建和部署！

### 5️⃣ 更新角色卡
1. 获得 Cloudflare Pages URL（如 `https://villain-game.pages.dev`）
2. 编辑 `角色卡-反派逆袭系统.json`
3. 将 iframe 的 `src` 改为你的 URL
4. 分享这个 JSON 文件给用户

---

## 👥 用户：3 步开始游戏

### 1️⃣ 下载角色卡
获取 `角色卡-反派逆袭系统.json` 文件

### 2️⃣ 导入到 SillyTavern
SillyTavern > 角色管理 > 导入 JSON

### 3️⃣ 开始玩
选择角色，游戏界面自动出现！

**就是这么简单！**

---

## 🔑 关键改进

### 之前（本地安装）
❌ 用户需要复制文件到 SillyTavern 目录
❌ 需要重命名文件夹
❌ 需要手动配置 iframe
❌ 难以分享和传播

### 现在（角色卡分享）
✅ 用户只需导入一个 JSON 文件
✅ 无需任何手动操作
✅ 一键开始游戏
✅ 轻松分享给朋友

---

## 🎯 技术原理

基于 **GoblinGame** 的成功经验：

1. **Webpack 单文件打包**：所有代码打包成一个 HTML
2. **Cloudflare Pages**：全球 CDN，快速加载
3. **世界书 iframe**：游戏界面嵌入角色卡
4. **window.TavernHelper**：直接访问酒馆 API（无跨域！）

### 为什么有效？

```javascript
// ❌ 旧方法（GitHub Pages）- 跨域错误
if (typeof parent.TavernHelper !== 'undefined') {
    // SecurityError: Blocked cross-origin frame access
}

// ✅ 新方法（Cloudflare + iframe）- 完美工作！
if (typeof window.TavernHelper !== 'undefined') {
    // TavernHelper 被酒馆全局注入到 iframe
    await window.TavernHelper.generate({ ... });
}
```

**关键发现**：酒馆会将 `TavernHelper` **自动注入到 iframe 的全局作用域**，无需从 parent 获取！

---

## 📂 项目文件结构

```
villain-game-app/
├── webpack.config.js          # Webpack 配置（单文件打包）
├── package.json               # npm 脚本和依赖
├── game.js                    # 游戏逻辑（已修改 TavernHelper 访问）
├── index.html                 # HTML 模板
├── style.css                  # 样式文件
├── 反派逆袭系统指南.yaml       # 游戏配置
│
├── 角色卡-反派逆袭系统.json    # 用户导入的角色卡
├── 角色卡分享部署指南.md       # 详细部署文档
├── 角色卡分享-快速开始.md      # 本文件
├── 通过角色卡分享方案.md       # 完整技术方案
└── 跨域解决方案分析.md         # 问题分析文档
```

---

## 🔧 常用命令

```bash
# 安装依赖
npm install

# 本地构建
npm run build

# 本地开发服务器
npm run dev

# 清理 dist 目录
npm run clean
```

---

## 📊 部署状态检查

### GitHub Actions
- 访问：GitHub 仓库 > Actions
- 状态：✅ 绿色勾 = 成功

### Cloudflare Pages
- 访问：https://dash.cloudflare.com/
- 查看：Pages > villain-game > Deployments

### 测试部署
```bash
# 直接在浏览器打开
https://你的域名.pages.dev/index.html

# 应该看到游戏界面
```

---

## 🐛 快速故障排除

| 问题 | 解决方法 |
|-----|---------|
| **npm install 失败** | 检查 Node.js 版本（需要 18+） |
| **构建失败** | 查看错误信息，可能缺少依赖 |
| **GitHub Actions 失败** | 检查 Secrets 配置 |
| **游戏界面不显示** | 检查 iframe URL 是否正确 |
| **TavernHelper 未找到** | 确保在 SillyTavern 中运行 |
| **AI 不回复** | 检查酒馆的 AI API 配置 |

---

## 📚 完整文档

- **快速开始**（本文件）：5 分钟快速上手
- [角色卡分享部署指南](./角色卡分享部署指南.md)：详细部署步骤
- [通过角色卡分享方案](./通过角色卡分享方案.md)：完整技术方案
- [跨域解决方案分析](./跨域解决方案分析.md)：问题分析和对比

---

## 🎊 恭喜！

你现在拥有了一个：

- ✅ **零安装**的游戏分享方案
- ✅ **自动更新**的部署流程
- ✅ **全球 CDN**加速
- ✅ **完整 AI 交互**能力

**享受你的反派逆袭之旅吧！**

---

## ❓ 需要帮助？

遇到问题？查看详细文档或提交 Issue：

1. 📖 查看完整文档（上面的链接）
2. 🔍 检查浏览器控制台（F12）
3. 📝 提交 GitHub Issue
4. 💬 在社区寻求帮助

---

生成时间：2025-01-06
